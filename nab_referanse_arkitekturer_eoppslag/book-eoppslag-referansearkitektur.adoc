:lang: no
:doctitle: Referansearkitektur for eOppslag
:keywords: Referansearkitekturer

include::../plattform_felles/includes/commonincludes.adoc[]
== Om eOppslag

eOppslag er en delmengde av kapabilitesområdet deling av data på forespørsel. Mønsteret dekker oppslag i informasjon, hvilket vil si forespørsel om informasjon mellom to parter, hvor en prosess hos konsumenten typisk er avhengig av informasjon fra tilbyder for å fortsette.

Beskrivelsen her er avgrenset til det å tilby og konsumere data gjennom synkrone kall mot APIer. Den dekker både sikrede APIer hvor tilgangsstyring løses ved bruk av blant annet fellestjenester, og åpne APIer som tilbyr åpent tilgjengelige data. En stor del av beskrivelsene tar for seg oppsett og bruk av tjenester tilknyttet tilgangsstyring, men dette er ikke obligatorisk for APIer som tilbyr åpne data.

I innledningen til referansearkitekturer er det skissert ulike kapabilitetsområder og identifisert overordnede kapabiliteter som inngår i de ulike referansearkitekturene. I dette kapittelet detaljeres kapabilitetene tilknyttet eOppslag.


== Struktur på beskrivelsen
Første modellen i beskrivelsen detaljerer de overordnede kapabilitetene som inngår i eOppslag. Disse kapabilitetene beskrives videre i hver sin modell og detaljeres gjennom prosesstegene som skal til for å realisere kapabiliteten. Det vises også til forretningstjenestene og noe av kjerneinformasjonen som benyttes i prosessene.

Modellene viser relasjonene mellom de ulike elementene og elementene er forklart i tabellene under hver modell. Elementer som benyttes flere ganger, f.eks. rollen som tilbyder, forklares kun tilknyttet modellen på høyest nivå.


== Oversikt eOppslag
Modellen under viser de kapabilitetene en tilbyder og en konsument må ha for å dele data gjennom tilgangsstyrte APIer.

Tilbyder må kunne tilggjengeliggjøre data og dette er delt i to kapabiliteter hvor den ene, "Registrering av API" går ut på hvordan man registerer og setter opp tilganger. Den andre kapabiliteten "Avgi forespurte data" er det man gjøre når en konsument gjøre et kall mot det respektive APIet.

Tilsvarende er det tre detaljerte kapabiliteter tilknyttet konsument. Få tilgang til API" består av prosesser for oppsett tilgang, "Delegering av rettigheter til databehandler" må gjøres dersom konsument benytter seg av en databehandler og "Slå opp data gjennom synkront API" er det konsumenten må gjøre hver gang det gjøres et oppslag.

image:../nab_referanse_arkitekturer/media/Deling på forespørsel.png[alt="Bilde mangler", width=750]

[cols ="1,1,3", options="header"]
.Elementer i figur for deling av data på forespørsel
|===
|Element
|Elementtype
|Beskrivelse

|Tilbyder av data
|Rolle
|Den part som besitter informasjon som kan deles.

|Konsument (databruker)
|Rolle
|Den part som i en egen virksomhetsprosess har behov for informasjon fra en annen part.


|Tilgjengeliggjøring av data
|Kapabilitet
|Evnen til å gjøre data tilgjengelig for aktører utenfor egen virksomhet.

|Registerering av sikkert API
|Sub-kapabilitet
|Del av "tilgjengeliggjøreing av data". Evnen til å registrere eget API i fellestjenester så det blir tilgjengelig for andre aktører.

|Avgi forespurte data
|Sub-kapabilitet
|Del av "tilgjengeliggjøreing av data". Evene til å avgi data på forespørsel gjennom et egnet API. Kan omfatte tilgangsstyring.

|Innhenting av data
|Kapabilitet
|Evenen til å hente tilbydte data fra annen aktør.

|Få tilgang til API
|Sub-kapabilitet
|Evnen til å få tilgang til tilbydte data fra annen aktør. 


|Delegering av rettigheter til databehandler
|Sub-kapabilitet
|Evnen til å delegere rettigheter til databehandler som utfører oppgaver på vegne av behandlingsansvarlig


|Slå opp data gjennom et API
|Sub-kapabilitet
|Evnen til å slå opp og hente data gjennom et eksternt API.

|===

//== Detaljerte 
beskrivelser 

== Arkitekturmønstre (konseptuelle  beskrivelser, kun arkitekturbyggeklosser)

I dette kapittelet beskrives lapabilitetene som inngår i eOppslag. Modellen består av tre nivåer. 

* I midten er det spesifisert noen prosessteg som realiserer kapabiliteten. Det vil si at kan du gjennomføre prosesstegene innehar du evnen kapabiliten beskriver.


* Nederst i figuren er det beskrevet de fellestjenestene og elementene som støtter prosessene.

* Øverst i figurene er det en knytning til hvilken kapabilitet dette er en del av, rollen som utfører prosesstegene og eventuelle andre avhengigheter som må på plass for å kunne gjennomføre prosessene, f.eks. inngå bilaterale avtaler.

De grunnleggende elementene i modellene i kapittelet foklares i denne figuren:

image:../nab_referanse_arkitekturer/media/forklaring prosess.png[alt="Bilde mangler", width=250]


=== Registrering av API

Modellen under detaljerer kapabiliteten "Registerering av sikkert API". Dette er det tilbyder av data må gjennomføre for å gjøre et API synlig og tilgjengelig gjennom fellesløsninger. Registrering av konsumenters rettigheter og tilganger inngå også som et prosessteg. Dersom det er registrering av et åpent API er det kun relevante prossessteg som utføres.


image:../nab_referanse_arkitekturer/media/registrere API.png[alt="Bilde mangler", width=750]

[cols ="1,1,3", options="header"]
.Elementer i figur for registrering av API
|===
|Element
|Elementtype
|Beskrivelse

|Inngå avtale om tilgang til data
|Prosess
|Prosess for å inngå avtale om tilgang og bruk av data.

|Bruksavtale
|Kontrakt
|Avtale eller kontrakt om tilgang til og bruk av data. Dette kan for eksempel være en bilateralt utformet avtale, aksept av generelle bruksvilkår, eller lisens for bruken av åpne data.

|Opprette tilbyder hos leverandør av tokentjeneste
|Prosess
|Prosess for tilbyder å opprettes som bruker av fellesløsning for tilgangsstyring.

|Registrere API
|Prosess
|Prosess for tilbyder å registrere API i nasjonale fellesløsninger så det blir letter tilgjengelig for konsumenter.

|Registrere tilganger til API
|Prosess
|Prosess for å registrere tilganger til de virksomheter som har et gyldig behandlingsgrunnlag og som har inngått avtale om tilgang til data.

|Bruksvilkår
|Forretningsobjekt
|Bruksvilkår for bruk av fellestjeneste for autentisering og autorisasjon.

|Registreringstjeneste for tilbyder av API
|Forretningstjeneste
|Tjeneste for tilbyder å registrere seg som brukersted for felles tokentjeneste for autentisering og autorisasjon.

|API-registreringstjeneste for tilbyder
|Forretningstjeneste
|Tjeneste for å registerer de APIene man ønsker å tilby til konsumenter og egenskaper ved disse.

|Token egenskaper
|Forretningsobjekt
|Egenskaper  ved token, f.eks. granulariteten på tilganger.

|Tilgangsregistreringstjeneste
|Forretningstjeneste
|Tjeneste for å registrere de virksomhetene som skal få tilgang til APIer og hvilket tilgangsnivå de skal ha.

|Orgnr. databruker
|Forretningsobjekt
|Organisasjonsnummeret til den som har avtale om å få tilgang til data.

|===


=== Avgi forespurte data
Modellen under detaljerer kapabiliteten "Avgi forespurte data". Dette er det tilbyder av data må gjøre for å svare på en forespørsel. Prosessen kontrollere tilgang gjøres kun dersom det er enakk om å avgi data gjennom et sikret API.


image:../nab_referanse_arkitekturer/media/avgi data.png[alt="Bilde mangler", width=400]


[cols ="1,1,3", options="header"]
.Elementer i figur for å avgi forespurte data
|===
|Element
|Elementtype
|Beskrivelse

|Policytjeneste
|Forretningstjeneste
|Intern tjeneste hos tilbyder for å håndheve tilgangsnivåpolicy ved tilgangsstyring.

|Motta forespørsel om oppslag
|Forretningsprosess
|Prosess med å motta forespørsler om å utlevere data fra API-konsument.

|Kontroller tilgang
|Forretningsprosess
|Prosessen med å kontrollere om konsumenten har rettigheter til å få de forespurte data.

|Avgi data
|Forretningsprosess
|Prosessen med å gi svar på forespørselen.

|Verifiseringstjeneste
|Forretningstjeneste
|Tjeneste for å verifisere autentiserings- og autorisasjonsdata i mottatt forespørsel.

|===


=== Få tilgang til API
Modellen under detaljerer kapabiliteten "Få tilgang til API". Dette er det en konsument av data må gjøre for å få tilgang til data gjennom et API. Det omfatter å få kjennskap til APIet, inngå avtaler om bruk av data og fellesløsninger, og registrere den teknsike komponenten som skal utføre tjenestekallet. Dersom det er tilgang til et åpent API er det kun relevante prossessteg som utføres.


image:../nab_referanse_arkitekturer/media/få tilgang til API.png[alt="Bilde mangler", width=750]


[cols ="1,1,3", options="header"]
.Elementer i figur for å få tilgang til API
|===
|Element
|Elementtype
|Beskrivelse

|Bruksavtale
|Kontrakt
|Se over

|Finne/få kjennskap til API
|Forretningsprosess
|Prosessen med å finne eller få kjennskap til tilgjengelige APIer. Benytter tjeneste for å søke i fellesløsninger.

|Inngå avtale om tilgang til data
|Forretningsprosess
|Konsumenten sin porsess med å inngå eventuell avtale med tilbyder om tilgang til data.

|Inngå bruksavtale med leverandør av tokentjenester
|Forretningsprosess
|Prosessen med å inngå bruksavtale for å benytte fellesløsning for tilgangstyring når man skal benytte APIer som er sikret ved bruk av fellesløsninger.

|Registrer klient med tildelt tilgang
|Forretningsprosess
|Prosess for konsument å registerere (provisjonering av) den klienten som skal ha tilgang til APIet. Dette forutsetter at tilbyder har gitt konsument tilgang.

|Leverandør registrerer klient med tildelt tilgang
|Forretningsprosess
|Prosess for leverandør til konsument å registerere (provisjonering av) den klienten som skal ha tilgang til APIet. Dette forutsetter at tilbyder har gitt konsument tilgang og at leverandør har blitt delegert rettigheter som databehandler på vegne av konsument.

|API-søk
|Forretningstjeneste
|Tjeneste for å søke etter og finne tilgejgnelig APIer. 

|Avtaletjeneste
|Forretningstjeneste
|Tjenste for å inngå avtale om bruk av en fellesløsning.

|Registreringstjeneste for API-bruker
|Forretningstjeneste
|Tjeneste for å registere brukere av tokentjeneste

|===


=== Delegering av rettigheter til databehandler
Modellen under detaljerer kapabiliteten "Delegering av rettigheter til databehandler". Dette er det en konsument må gjøre for at en leverandør kan identifisere seg med sitt eget virksomhetssertifikat og opptre på vegne av konsumenten som er den som innehar behandlingsgrunnlaget for å innhente data.

image:../nab_referanse_arkitekturer/media/delegering av rettigheter.png[alt="Bilde mangler", width=350]

[cols ="1,1,3", options="header"]
.Elementer i figur for delegering av rettigheter til databehandler
|===
|Element
|Elementtype
|Beskrivelse

|Tjenesteavtale
|Kontrakt
|Avtale mellom leverandør og konsument som er grunnlaget for å kunne delegere rettigheter fra konsument til en leverandør

|Leverandør
|Rolle
|En part som leverer tjenester eller utfører oppgaver på vegne av en annen part.

|Inngå avtale med leverandør
|Prosess
|Prosessen med å inngå en avtale med leverandør. En slik avtale vil normalt være inngått tidligere og uavhengig av om man skal ta i bruk et nytt API.  En tjenesteavtale med leverandør er en forutsetning forutsetning for å kunne delegere en tilgang.

|Registrere delegert tilgang
|Prosess
|Prosessen med å delegere tilganger. I tilknytning til eOppslag vil formålet være å gi leverandør tilgang til å representere konsument overfor et API, men registreringen vil potensielt også kunne gjelde for andre områder.

|Registreringstjeneste for representasjons-forhold
|Forretningstjeneste
|Tjeneste for å registerer representasjonsforhold. I dette tilfellet delegering av rettigheter til å benytte et API på vegne av konsument.

|===

=== Slå opp data gjennom et API
Modellen under detaljerer kapabiliteten "Slå opp data gjennom et API". Dette er det en konsument må gjøre når det utføres et tjenestekall for å innhente data gjennom et API. Dersom det er et åpent API er det kun relevante prossessteg som utføres.

image:../nab_referanse_arkitekturer/media/slå opp data.png[alt="Bilde mangler", width=350]

[cols ="1,1,3", options="header"]
.Elementer i figur for å slå opp data
|===
|Element
|Elementtype
|Beskrivelse

|Hent teknisk endepunkt ved behov
|Forretningsprosess
|Prosessen å slå opp den tekniske adressen til et API før spørring mot APIet dersom dette er nødvendig.

|Be om tilgangstoken
|Forretningsprosess
|Prosessen med å benytte en tokentjeneste for hente et tilgangstoken som gir tilgang til et API. Dette forutsetter at alt er registert og satt opp riktig mot de aktuelle tjenestene.

|Utfør tjenestekall
|Forretningsprosess
|Prosessen med å benytte (gjøre et oppslag mot) et eksternt API

|Adressetjeneste
|Forretningstjeneste
|Tjeneste som gir mulighet til å slå opp teknisk endepunkt.

|Tokentjeneste
|Forretningstjeneste
|Tjeneste som utsteder tilgangstoken.

|Representasjonstjeneste
|Forretningstjeneste
|Tjeneste som gir oversikt over representasjonsforhold. Benyttes av tokentjeneste dersom en leverandør skal få tilgang på vegne av en konsument
|===

== Løsningsmønstre (logiske beskrivelser med arkitekturbyggeklosser og aktuelle løsningsbyggeklosser)
TBD.


